<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Minting</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #29abe2;
            --primary-dark: #007aa8;
            --background: #0c1f3f;
            --card-bg: #ffffff;
            --text: #1e1e1e;
            --border-radius: 12px;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, var(--background), #09152a);
            color: var(--text);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            padding: 40px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            max-width: 400px;
            width: 90%;
        }

        h1 {
            color: var(--primary-dark);
            text-align: center;
            margin-bottom: 30px;
        }

        label {
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0 20px 0;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: var(--border-radius);
        }

        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            font-size: 16px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        button:hover {
            background-color: var(--primary-dark);
        }

        #walletInfo {
            margin-top: 30px;
        }

        #walletStatus {
            display: block;
            margin-bottom: 10px;
        }

        h3 {
            margin-top: 20px;
            color: var(--primary-dark);
            font-weight: normal;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.5.0/ethers.umd.min.js"></script>
    <script src="./mintABI.js" type="text/javascript"></script>
</head>
<body onload="checkWallet()">

    <div class="container">
        <h1>Mint Your Tokens</h1>

        <label for="tokenAmount">Number of tokens to mint:</label>
        <input type="number" id="tokenAmount" min="1" placeholder="e.g., 3" />
        <button onclick="mintTokens()">Mint</button>

        <section id="walletInfo">
            <b>Wallet connection:</b>
            <span id="walletStatus" style="color:red">Checking for a wallet connection...</span>
            <button onclick="checkWallet()" id="walletButton">Connect Wallet</button>
        </section>

        <h3><span id="responseMessage"></span></h3>
    </div>

    <script>
        let myWallet, myContract, provider, signer;

        async function checkWallet() {
            try {
                const accounts = await ethereum.request({ method: 'eth_accounts' });
                myWallet = accounts[0];

                if (!myWallet) {
                    await ethereum.request({ method: 'eth_requestAccounts' });
                    const newAccounts = await ethereum.request({ method: 'eth_accounts' });
                    myWallet = newAccounts[0];
                }

                if (!myWallet) {
                    document.getElementById('walletStatus').innerHTML = "Click below to connect your wallet:";
                    document.getElementById('walletButton').hidden = false;
                } else {
                    document.getElementById('walletStatus').innerHTML = "‚úì Wallet connected.";
                    document.getElementById('walletStatus').style.color = "green";
                    document.getElementById('walletButton').hidden = true;
                }

                await contractConnect();
            } catch (err) {
                console.error("Wallet connection error:", err);
            }
        }

       async function contractConnect() {
    try {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();

        console.log("üöÄ ABI:", window.mintABI);
        console.log("üöÄ Contract address:", window.mintContractAddress);

        if (!window.mintABI || !window.mintContractAddress) {
            console.error("‚ùå ABI or contract address not loaded!");
            return;
        }

        myContract = new ethers.Contract(window.mintContractAddress, window.mintABI, provider);
        console.log("‚úÖ Contract instance created:", myContract);
    } catch (err) {
        console.error("‚ùå Error in contractConnect:", err);
    }
}
        async function mintTokens() {
            const mintAmount = parseInt(document.getElementById('tokenAmount').value);

            if (!mintAmount || mintAmount <= 0) {
                alert('Please enter a number greater than zero.');
                return;
            }

            try {
                const contractWithSigner = myContract.connect(signer);
                const tx = await contractWithSigner.mintFunction(mintAmount);
                const receipt = await tx.wait();
                console.log("Mint success. Tx Hash:", receipt.transactionHash);
                document.getElementById('responseMessage').innerHTML = "‚úÖ Tokens minted successfully!";
            } catch (error) {
                console.error("Error minting tokens:", error);
                document.getElementById('responseMessage').innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>
